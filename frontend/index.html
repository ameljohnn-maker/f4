<!DOCTYPE html>
<html>
<body>

<!-- Insert Data -->

<h1>INSERT DATA</h1>

<form id="form">
    <input id="name" placeholder="Name"><br>
    <input id="age" placeholder="Age"><br>
    <input id="gender" placeholder="Gender"><br>
    <input id="race" placeholder="Race"><br>
    <input id="class" placeholder="Class"><br> 
    <input id="faction" placeholder="Faction"><br>
    <button>insert</button>
</form>


<script>
form.onsubmit = async e =>{
    e.preventDefault();
  const res = await fetch('https://f4-production.up.railway.app/users/users', {
     method: 'POST',
     headers: {'Content-Type': 'application/json'},
     body: JSON.stringify({
        name: document.getElementById('name').value,
        age: document.getElementById('age').value,
        gender: document.getElementById('gender').value,
        race: document.getElementById('race').value,
        class: document.getElementById('class').value,
        faction: document.getElementById('faction').value
     })
  });
  alert('data inserted successfully');
};
</script>


<!-- Display Data / Update  Data/ Delete  Data-->

<h1>DISPLAY DATA / UPDATE DATA / DELETE DATA</h1>

<table border="1">
    <thead>
        <tr>
            <th>Character ID</th>
            <th>Name</th>
            <th>Age</th>
            <th>Gender</th>
             <th>Race</th>
              <th>Class</th>
               <th>Faction</th>
               
        </tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<script>
const getEl = id => document.getElementById(id);

fetch('https://f4-production.up.railway.app/users/display')
    .then(response => response.json())
    .then(users => {
        getEl('tableBody').innerHTML = users.map(user => `
            <tr id="row-${user.id}">
                <td>${user.id}</td>
                <td id="name-${user.id}">${user.name}</td>
                <td id="age-${user.id}">${user.age}</td>
                 <td id="age-${user.id}">${user.gender}</td>
                  <td id="age-${user.id}">${user.race}</td>
                   <td id="age-${user.id}">${user.class}</td>
                    <td id="age-${user.id}">${user.faction}</td>
                <td>
                    <button onclick="editUser(${user.id})">Edit</button>
                    <button onclick="saveUser(${user.id})" id="save-${user.id}" hidden>Save</button>
                    <button onclick="cancelEdit(${user.id})" id="cancel-${user.id}" hidden>Cancel</button>
                    <button onclick="deleteUser(${user.id})" style="color: red;">Delete</button>
                </td>
            </tr>
        `).join('');
    });

function editUser(id) {
    getEl(`name-${id}`).innerHTML = `<input id="edit-name-${id}" value="${getEl(`name-${id}`).innerText}">`;
    getEl(`age-${id}`).innerHTML = `<input id="edit-age-${id}" value="${getEl(`age-${id}`).innerText}">`;
     getEl(`age-${id}`).innerHTML = `<input id="edit-age-${id}" value="${getEl(`gender-${id}`).innerText}">`;
      getEl(`age-${id}`).innerHTML = `<input id="edit-age-${id}" value="${getEl(`race-${id}`).innerText}">`;
       getEl(`age-${id}`).innerHTML = `<input id="edit-age-${id}" value="${getEl(`class-${id}`).innerText}">`;
        getEl(`age-${id}`).innerHTML = `<input id="edit-age-${id}" value="${getEl(`faction-${id}`).innerText}">`;
    
    getEl(`save-${id}`).hidden = false;
    getEl(`cancel-${id}`).hidden = false;
}

async function saveUser(id) {
    try {
        const response = await fetch(`https://f4-production.up.railway.app/users/${id}`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: getEl(`edit-name-${id}`).value,
                age: getEl(`edit-age-${id}`).value,
                gender: getEl(`edit-gender-${id}`).value,
                race: getEl(`edit-race-${id}`).value,
                class: getEl(`edit-class-${id}`).value,
                faction: getEl(`edit-faction-${id}`).value
            })
        });
        
        if (!response.ok) throw new Error('Update failed');
        
        const user = await response.json();
        getEl(`name-${id}`).innerHTML = user.name;
        getEl(`age-${id}`).innerHTML = user.age;
        getEl(`gender-${id}`).innerHTML = user.gender;
        getEl(`race-${id}`).innerHTML = user.race;
        getEl(`class-${id}`).innerHTML = user.class;
        getEl(`faction-${id}`).innerHTML = user.faction;
        getEl(`save-${id}`).hidden = true;
        getEl(`cancel-${id}`).hidden = true;
        
        alert('User updated!');
    } catch (error) {
        console.error('Error:', error);
        alert('Update failed');
        cancelEdit(id);
    }
}

function cancelEdit(id) {
    fetch(`https://f4-production.up.railway.app/users/${id}`)
        .then(response => response.json())
        .then(user => {
            getEl(`name-${id}`).innerHTML = user.name;
            getEl(`age-${id}`).innerHTML = user.age;
            getEl(`gender-${id}`).innerHTML = user.gender;
            getEl(`race-${id}`).innerHTML = user.race;
            getEl(`class-${id}`).innerHTML = user.class;
            getEl(`faction-${id}`).innerHTML = user.faction;
            getEl(`save-${id}`).hidden = true;
            getEl(`cancel-${id}`).hidden = true;
        });
}

async function deleteUser(id) {
    if (!confirm('Are you sure you want to delete this user?')) return;
    
    try {
        await fetch(`https://f4-production.up.railway.app/users/${id}`, {
            method: 'DELETE'
        });

        getEl(`row-${id}`).remove();
        alert('User deleted successfully!');
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to delete user');
    }
}
</script>

</body>
</html>
  


